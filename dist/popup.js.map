{
  "version": 3,
  "sources": ["../src/popup.ts"],
  "sourcesContent": ["function $<T extends HTMLElement = HTMLElement>(id: string): T | null {\n  return document.getElementById(id) as T | null;\n}\n\nfunction showStatus(text: string) {\n  console.log(\"SHOWING STATUS:\", text);\n  const status = $(\"status\");\n  const content = $(\"content\");\n  if (status) {\n    status.style.display = \"block\";\n    status.innerHTML = text;\n  }\n  if (content) content.style.display = \"none\";\n}\n\nfunction showContent() {\n  console.log(\"SHOWING CONTENT\");\n  const status = $(\"status\");\n  const content = $(\"content\");\n  if (status) status.style.display = \"none\";\n  if (content) content.style.display = \"block\";\n}\n\nfunction formatNumber(num: number | null | undefined): string {\n  if (num === null || num === undefined) return \"\u2014\";\n  if (num >= 1000000) return (num / 1000000).toFixed(1) + \"M\";\n  if (num >= 1000) return (num / 1000).toFixed(1) + \"K\";\n  return num.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\nfunction firstN(text: string | undefined | null, n = 120) {\n  if (!text) return \"\";\n  const s = text.trim().replace(/\\s+/g, \" \");\n  return s.length <= n ? s : s.slice(0, n).trim() + \"\u2026\";\n}\n\nfunction displayData(stats: any) {\n  console.log(\"DISPLAYING DATA:\", stats);\n  showContent();\n\n  // Title & author\n  const titleEl = $(\"title\");\n  const authorEl = $(\"author\");\n  if (titleEl) titleEl.textContent = stats.title || \"Untitled Story\";\n  if (authorEl) authorEl.textContent = stats.author ? `by ${stats.author}` : \"by Unknown Author\";\n\n  // Stats cards\n  const readsEl = $(\"reads\");\n  const votesEl = $(\"votes\");\n  const headerCommentsEl = $(\"headerComments\");\n  const commentItemsCountEl = $(\"commentItemsCount\");\n  if (readsEl) readsEl.textContent = formatNumber(stats.reads);\n  if (votesEl) votesEl.textContent = formatNumber(stats.votes);\n  if (headerCommentsEl) headerCommentsEl.textContent = formatNumber(stats.headerComments);\n  if (commentItemsCountEl) commentItemsCountEl.textContent = formatNumber(stats.commentItemsCount);\n\n  // Calculate engagement\n  const engagementRate = stats.reads && stats.votes && stats.reads > 0\n    ? ((stats.votes / stats.reads) * 100).toFixed(2) + \"%\"\n    : \"\u2014\";\n  const commentRatio = stats.reads && stats.headerComments && stats.reads > 0\n    ? ((stats.headerComments / stats.reads) * 100).toFixed(2) + \"%\"\n    : \"\u2014\";\n\n  const engagementEl = $(\"engagementRate\");\n  const commentRatioEl = $(\"commentRatio\");\n  if (engagementEl) engagementEl.textContent = engagementRate;\n  if (commentRatioEl) commentRatioEl.textContent = commentRatio;\n\n  // Display top hits\n  const topHitsList = $(\"topHitsList\");\n  if (topHitsList && stats.paragraphComments) {\n    topHitsList.innerHTML = \"\";\n    const top = [...stats.paragraphComments]\n      .sort((a, b) => (b.count ?? 0) - (a.count ?? 0))\n      .slice(0, 3);\n\n    top.forEach((p, index) => {\n      const li = document.createElement(\"li\");\n      const count = p.count ?? 0;\n      const snippet = firstN(p.snippet || p.raw);\n      li.setAttribute(\"data-rank\", `#${index + 1}`);\n      li.innerHTML = `<strong>${count} comment${count === 1 ? \"\" : \"s\"}:</strong> \"${snippet}\"`;\n      if (index === 0) li.classList.add(\"top-hit\"); // Top hit with star\n      else if (count < 5) li.classList.add(\"revise\"); // Low engagement flag\n      if (topHitsList) topHitsList.appendChild(li);\n    });\n  }\n\n  // Custom chart to match image\n  const canvas = $(\"commentsChart\");\n  if (canvas instanceof HTMLCanvasElement && stats.paragraphComments && canvas) {\n    const ctx = canvas.getContext(\"2d\");\n    if (ctx) {\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      const isDark = document.body.classList.contains(\"dark-theme\");\n      const textColor = isDark ? \"#e2e8f0\" : \"#4a5568\";\n      const gridColor = isDark ? \"#4a5568\" : \"#e2e8f0\";\n      const accentColor = isDark ? \"#26a69a\" : \"#26a69a\";\n\n      // Title\n      ctx.fillStyle = accentColor;\n      ctx.font = \"14px Arial\";\n      ctx.fillText(\"Comment Distribution\", 10, 20);\n\n      // Axes and grid\n      ctx.strokeStyle = gridColor;\n      ctx.lineWidth = 1;\n      ctx.beginPath();\n      ctx.moveTo(30, 20);\n      ctx.lineTo(30, canvas.height - 30);\n      ctx.lineTo(canvas.width - 10, canvas.height - 30);\n      ctx.stroke();\n\n      // Grid lines and labels\n      const maxCount = Math.max(...stats.paragraphComments.map((p: any) => p.count ?? 0));\n      for (let i = 0; i <= 5; i++) {\n        const y = canvas.height - 30 - (i / 5) * (canvas.height - 60);\n        ctx.beginPath();\n        ctx.moveTo(30, y);\n        ctx.lineTo(canvas.width - 10, y);\n        ctx.strokeStyle = gridColor;\n        ctx.lineWidth = 0.5;\n        ctx.stroke();\n        ctx.fillStyle = textColor;\n        ctx.fillText((maxCount * i / 5).toFixed(0), 5, y);\n      }\n      for (let i = 0; i < 15; i++) {\n        const x = 30 + i * 25;\n        ctx.fillText(`P${i + 1}`, x, canvas.height - 15);\n      }\n\n      // Bars with gradient\n      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);\n      gradient.addColorStop(0, \"rgba(38, 166, 154, 0.8)\");\n      gradient.addColorStop(1, \"rgba(38, 166, 154, 0.3)\");\n      stats.paragraphComments.slice(0, 15).forEach((p: any, i: number) => {\n        const height = maxCount > 0 ? (p.count ?? 0) / maxCount * 120 : 0;\n        const x = 30 + i * 25;\n        const y = canvas.height - 30 - height;\n        ctx.fillStyle = gradient;\n        ctx.fillRect(x, y, 20, height);\n        ctx.fillStyle = textColor;\n        ctx.font = \"10px Arial\";\n      });\n    }\n  }\n\n  // Display paragraphs\n  const paragraphsList = $(\"paragraphsList\");\n  if (paragraphsList && stats.paragraphComments) {\n    paragraphsList.innerHTML = \"\";\n    stats.paragraphComments.forEach((p: any) => {\n      const div = document.createElement(\"div\");\n      div.classList.add(\"para\");\n      const count = p.count ?? 0;\n      const snippet = firstN(p.snippet || p.raw);\n      div.innerHTML = `<strong>P${stats.paragraphComments.indexOf(p) + 1}:</strong> ${count} comment${count === 1 ? \"\" : \"s\"} - \"${snippet}\"`;\n      if (count > 5) div.classList.add(\"highlight\");\n      else if (count < 2) div.classList.add(\"boost\");\n      if (paragraphsList) paragraphsList.appendChild(div);\n    });\n  }\n\n  // Analytics suggestion\n  const suggestionEl = $(\"analyticsSuggestion\");\n  if (suggestionEl && stats.paragraphComments) {\n    const minCountIndex = stats.paragraphComments.reduce((minIndex: number, p: any, i: number, arr: any[]) =>\n      (p.count ?? 0) < (arr[minIndex].count ?? 0) ? i : minIndex, 0);\n    if (suggestionEl) suggestionEl.textContent = minCountIndex >= 0 ? `_P${minCountIndex + 1} needs a twist!_` : \"Keep writing!\";\n  }\n\n  console.log(\"DATA DISPLAY COMPLETE!\");\n}\n\nfunction loadData() {\n  console.log(\"LOADING DATA FROM STORAGE...\");\n  showStatus(\"\uD83D\uDD04 Loading analytics...\");\n  \n  try {\n    chrome.storage.local.get([\"writerAnalyticsStats\"], function(result) {\n      console.log(\"STORAGE RESULT:\", result);\n      \n      if (chrome.runtime.lastError) {\n        console.error(\"STORAGE ERROR:\", chrome.runtime.lastError);\n        showStatus(\"\u274C Storage Error\");\n        return;\n      }\n      \n      const stats = result.writerAnalyticsStats;\n      \n      if (!stats) {\n        showStatus(`\n          <div style=\"text-align: center; padding: 20px;\">\n            <div style=\"font-size: 32px;\">\uD83D\uDCDD</div>\n            <div><strong>No Data Found</strong></div>\n            <div style=\"font-size: 12px; color: #666;\">Visit a Wattpad story page first!</div>\n          </div>\n        `);\n        return;\n      }\n      \n      console.log(\"CALLING DISPLAY DATA...\");\n      displayData(stats);\n    });\n  } catch (error: any) {\n    console.error(\"CRITICAL ERROR:\", error);\n    showStatus(\"\u274C Critical Error: \" + error.message);\n  }\n}\n\n// Theme toggle\nfunction initTheme() {\n  const themeToggle = $(\"theme-toggle\");\n  if (themeToggle) {\n    themeToggle.addEventListener(\"click\", function() {\n      const isDark = document.body.classList.toggle(\"dark-theme\");\n      const icon = themeToggle.querySelector(\".theme-icon\");\n      if (icon) {\n        icon.textContent = isDark ? \"\u2600\uFE0F\" : \"\uD83C\uDF19\";\n      }\n      // Re-render chart with new theme\n      const canvas = $(\"commentsChart\");\n      if (canvas instanceof HTMLCanvasElement) {\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx) displayData({ paragraphComments: [] }); // Trigger chart redraw\n      }\n    });\n  }\n}\n\n// Initialize\nconsole.log(\"POPUP SCRIPT STARTING...\");\n\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n  console.log(\"DOM LOADED!\");\n  initTheme();\n  setTimeout(loadData, 100);\n});\n\n// Emergency fallback\nsetTimeout(function() {\n  console.log(\"EMERGENCY FALLBACK CHECK\");\n  if ($(\"status\")?.textContent?.includes(\"Loading\")) {\n    console.log(\"STILL LOADING, RETRYING...\");\n    loadData();\n  }\n}, 2000);"],
  "mappings": "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",
  "names": []
}
